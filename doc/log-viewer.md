
# 로그 뷰어(Custom Editor) UX 사양서

본 문서는 VS Code Custom Editor로 구현될 **Log Viewer**의 사용자 경험(UX) 요구사항을 정의한다.  
구현은 **MVU(Model–View–Update)** 아키텍처를 따르며, **CSP 제약을 준수**하고 **Webpack 번들링**을 사용한다.

---

## 1) 최상위 레이아웃

- 화면은 크게 **Toolbar**, **Log View**, **하단 패널(검색 결과 / 북마크 모음)** 의 3영역으로 구성한다.
- 기본 상태에서는 Toolbar + Log View만 보이며, **검색 실행** 시에만 **검색 결과 패널**이 하단에 나타난다.
- **북마크가 하나 이상**일 때만 오른쪽에 **북마크 모음 패널**이 표시된다. 북마크가 없으면 숨김.
- **분리바(스플리터)**:
  - Log View ↔ 하단 패널 사이, Log View ↔ 북마크 모음 사이에 분리바를 둬 **드래그로 영역 크기를 조절**할 수 있다.
  - 드래그는 영역들 간의 **높이/너비만** 변화시켜야 하며, 다른 영역(예: Toolbar 높이)은 변하지 않는다.
  - 분리바 위치(비율)는 퍼시스트(복원) 가능하도록 상태로 저장한다.

---

## 2) Toolbar

- **구성(좌 → 우 예시)**  
  - 파일 정보/버퍼 상태(라인 수/표시 범위) 간단 표기 (선택)
  - **검색 입력** + 검색 버튼
    - 검색을 실행하면 하단에 “검색 결과 패널”이 나타난다.
    - **검색 취소** 시 패널은 다시 사라진다.
  - **하이라이트 토글 버튼**: 팝업을 열어 **최대 5개 키워드**를 설정(추가/삭제)할 수 있다.
    - 팝업은 VS Code webview 내에서 구현(모달 레이어). ESC/외부 클릭 닫힘 지원.
  - **컬럼 표시 토글**: 시간 / 프로세스 / PID / 메시지의 **표시/비표시** 체크박스.
    - 숨긴 컬럼은 레이아웃에서 제외되어 수평 공간을 절약한다.

> 참고: **로그 레벨은 필터 항목에 포함하지 않는다.**

---

## 3) Log View

- **표 구조**: `시간 | 프로세스 | PID | 메시지`
  - **파싱**: 입력되는 원본 로그 문자열(예: `[Dec 24 10:51:07.941] homey-pro[830]:  SQLite Connected`)을 위 4컬럼으로 파싱하여 표시.
- **스크롤 정책**
  - **수직 스크롤만 지원**한다.
  - **수평 스크롤은 지원하지 않음**. 좁은 화면에서도 보기 좋도록 텍스트는 컬럼 너비 내에서 말줄임 또는 래핑 전략을 사용한다.
- **행/열 크기 조절**
  - 각 **컬럼은 헤더 분리바로 너비 조절**이 가능해야 한다(드래그).
  - 행 높이는 고정(또는 설정 가능)이며 가독성 위주로 유지.
- **로그 버퍼**
  - **최대 2000 라인**까지 보관한다(순환 버퍼 권장). 그 이상 유입 시 오래된 로그부터 제거.
- **하이라이트**
  - Toolbar에서 지정한 1~5개의 키워드에 대해 **전 컬럼 대상 텍스트 하이라이트**를 적용한다.
  - 하이라이트 색은 구분 가능하지만 과도하지 않게(가독성 유지).
- **메시지 더블클릭(2번 클릭) → 호버 팝업**
  - 해당 로그의 **원본 전체 메시지**를 표시하는 팝업을 중앙 또는 커서 근처에 띄운다.
  - 팝업 내부에 **복사 버튼**과 **닫기 버튼** 제공.
  - ESC/외부 클릭 시 닫힘.
- **영역 선택 & 복사 (마우스 드래그)**
  - 사용자는 **셀 단위로 직사각형 영역**을 드래그 선택할 수 있어야 한다.
    - 예: 열 일부만(b,c,d), 행 일부만(3~5행), 또는 임의 직사각형 영역.
  - **우클릭 → “선택 내용 복사”** 컨텍스트 메뉴 제공.
  - 복사 형식: 탭으로 컬럼 분리, 줄바꿈으로 행 분리(클립보드 호환성).
- **북마크**
  - 각 행의 **좌측에 별표(☆/★) 버튼**. 클릭 시 토글.
  - 북마크가 존재하면 오른쪽에 **북마크 모음 패널** 자동 표시(없으면 숨김).
  - 북마크가 추가/삭제되면 모음 리스트 갱신.

---

## 4) 검색 결과 패널 (하단)

- **표시 시점**: Toolbar에서 검색을 실행하면 나타나고, **검색 취소** 시 사라진다.
- **내용**: 검색어와 일치하는 로그들의 **요약 리스트**(시간/프로세스/PID/메시지 일부 + 라인 인덱스).
- **동작**
  - 항목 클릭 시 **Log View가 해당 로그 위치로 스크롤**된다.
  - 도착 시 해당 로그가 **뷰 높이의 1/3 지점(상단 쪽)** 에 위치하도록 스크롤 오프셋을 맞춘다.
  - 선택된 로그는 **은은한 강조(선택 하이라이트)** 로 표시한다.
- **분리바**
  - Log View와 수직 분리바로 구분, **드래그로 높이 조절** 가능.
  - 높이 상태는 저장/복원.

---

## 5) 북마크 모음 패널 (우측)

- **표시 조건**: 북마크가 하나 이상일 때만 표시.
- **내용**: 북마크된 로그 항목 목록(간략 정보 + 라인 인덱스).
- **동작**
  - 항목 클릭 시 **Log View 스크롤 이동** + **1/3 지점 배치** + **선택 하이라이트** 적용.
- **분리바**
  - Log View와 수평 분리바로 구분, **드래그로 너비 조절** 가능.
  - 너비 상태는 저장/복원.

---

## 6) 성능 / 버퍼 정책

- **버퍼 최대치 2000 라인**(기본). 라인 수 초과 시 **FIFO 방식**으로 제거.
- 렌더링은 가급적 **가상화(virtualization)** 적용(대량 로그에서도 스크롤 성능 유지).
- 하이라이트/검색은 증분 업데이트 및 워커 활용을 고려(필요시).

---

## 7) 상호작용 세부

- **키보드**
  - ↑/↓/PgUp/PgDn/Home/End: 로그 이동/스크롤.
  - Enter/Space: 선택 토글(선택 모드일 때).
  - Ctrl/⌘+C: 선택 영역 복사.
  - Esc: 팝업 닫기, 선택 해제.
- **컨텍스트 메뉴**
  - “선택 내용 복사”, “모두 선택”, “북마크 추가/제거” 등.
- **접근성(ARIA)**
  - Log View는 `role="table"`, 행은 `role="row"`, 셀은 `role="cell"`을 사용.
  - 라이브 영역(`aria-live`)은 과도 사용 금지. 팝업에는 `aria-modal`/포커스 트랩 적용.

---

## 8) 상태 보존(퍼시스트)

- 다음 상태는 저장/복원한다.
  - 분리바 위치(하단 패널 높이, 북마크 패널 너비)
  - 표시/비표시 컬럼 설정
  - 하이라이트 키워드(최대 5개)
  - 마지막 검색어(선택)
- 저장 시점: 사용자 조작 커밋 시 또는 적절한 디바운스.

---

## 9) 아키텍처(MVU) 개요

- **Model**: 버퍼(라인 배열), 가시성/하이라이트/검색/북마크/분리바/컬럼설정 등 모든 상태.
- **View**: 위 상태를 기반으로 DOM을 렌더. 성능을 위해 영역별로 부분 업데이트.
- **Update**: 사용자 이벤트/메시지 수신을 **액션**으로 정의하고, 순수 함수로 Model → Model 변환.
- Webpack 번들링으로 CSP를 준수(인라인 스크립트/스타일 회피, nonce 사용 등).

---

## 10) 예외/오류 처리

- 파싱 실패 라인은 전체를 **메시지 칼럼**으로 표시(시간/프로세스/PID는 빈 값).
- 너무 긴 메시지는 뷰에서 줄바꿈/말줄임 처리, **팝업에서 전체 표시**.
- 대량 검색/하이라이트로 지연 발생 시 비동기 처리 및 로딩 인디케이터 고려.

---

## 11) 향후 확장 포인트(선택)

- 정규식 검색/하이라이트 옵션
- 내보내기/가져오기(JSON/텍스트)
- 시간 범위 필터, 프로세스/ PID 필터
- 다중 버퍼 탭(멀티 파일)

---

## 12) 확인 체크리스트

- [ ] Toolbar: 검색, 하이라이트(팝업), 컬럼 표시 토글 동작
- [ ] Log View: 파싱 표시, 수직 스크롤, 컬럼 리사이즈, 선택/복사, 메시지 팝업
- [ ] 검색 결과 패널: 나타남/사라짐, 클릭 이동(1/3 지점), 선택 하이라이트
- [ ] 북마크: 행 좌측 별표 토글, 우측 모음 패널, 클릭 이동(1/3 지점)
- [ ] 분리바: 상/하/우측 분리바 조절 & 퍼시스트
- [ ] 성능: 2000 라인에서 스크롤/검색/하이라이트 원활
- [ ] 접근성: 키보드/스크린리더 기본 동작

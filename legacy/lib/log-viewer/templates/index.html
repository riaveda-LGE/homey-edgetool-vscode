<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🚀 Edge Tool - 시스템 로그 뷰어</title>
    <link rel="stylesheet" href="/assets/css/style.css">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>🚀</text></svg>">
</head>
<body class="theme-dark">
    <!-- 헤더 -->
    <header class="header">
        <div class="header-content">
            <div class="title">
                <span class="title-icon">🚀</span>
                <span class="title-text">Edge Tool - 시스템 로그 뷰어</span>
                <span class="connection-status" id="connectionStatus">연결 중...</span>
            </div>
            <div class="toolbar">
                <button id="highlightBtn" class="toolbar-btn" title="하이라이트 규칙 관리">
                    🎨 하이라이트
                </button>
                <button id="bookmarkToggle" class="toolbar-btn" title="북마크 사이드바 토글">
                    📖 북마크
                </button>
                <div class="toolbar-divider"></div>
                <button id="settingsBtn" class="toolbar-btn" title="설정">
                    ⚙️
                </button>
            </div>
        </div>
    </header>

    <!-- 필터 섹션 -->
    <section class="filter-section">
        <div class="filter-content">
            <!-- 검색 바 -->
            <div class="search-container">
                <div class="search-input-wrapper">
                    <input type="text" class="search-input" placeholder="검색... (Ctrl+F)" id="searchInput">
                    <div class="search-controls">
                        <button class="search-btn search-prev" title="이전 (Shift+F3)" disabled>⬆</button>
                        <button class="search-btn search-next" title="다음 (F3)" disabled>⬇</button>
                        <span class="search-results-count">0/0</span>
                        <button class="search-btn search-close" title="검색 닫기 (ESC)">✕</button>
                    </div>
                </div>
            </div>

            <!-- 필터 컨트롤 -->
            <div class="filter-controls">
                <div class="filter-inputs">
                    <input type="text" id="messageFilter" placeholder="메시지 필터..." class="filter-input">
                    <select id="levelFilter" class="filter-select" style="display: none;">
                        <option value="">모든 레벨</option>
                        <option value="ERROR">ERROR</option>
                        <option value="WARN">WARN</option>
                        <option value="INFO">INFO</option>
                        <option value="DEBUG">DEBUG</option>
                    </select>
                    <input type="text" id="tagFilter" placeholder="태그 필터..." class="filter-input">
                    <input type="text" id="pidFilter" placeholder="PID 필터..." class="filter-input">
                </div>
                <div class="filter-actions">
                    <button id="clearFilters" class="filter-btn">필터 초기화</button>
                </div>
            </div>

            <!-- 활성 필터 태그들 -->
            <div class="active-filters" id="filterTags">
                <!-- 동적으로 생성되는 필터 태그들 -->
            </div>
        </div>
    </section>

    <!-- 통계 섹션 -->
    <section class="stats-section">
        <div class="stats-content">
            <div class="stat-item">
                <span class="stat-label">총 로그:</span>
                <span class="stat-value" id="totalLogs">0</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">표시된 로그:</span>
                <span class="stat-value" id="visibleLogs">0</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">북마크:</span>
                <span class="stat-value bookmark-counter" id="bookmarkCount">0</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">하이라이트:</span>
                <span class="stat-value" id="highlightCount">0/5</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">연결 상태:</span>
                <span class="stat-value" id="connectionInfo">연결 중</span>
            </div>
        </div>
    </section>

    <!-- 메인 컨테이너 -->
    <main class="main-container">
        <!-- 메인 로그 영역 -->
        <div class="log-panel main-log-panel">
            <div class="panel-header">
                <span class="panel-title">📊 실시간 로그</span>
                <div class="panel-controls">
                    <label class="auto-scroll-toggle">
                        <input type="checkbox" id="autoScrollToggle" checked>
                        자동 스크롤
                    </label>
                </div>
            </div>
            <div class="log-table-container" id="mainLogContainer">
                <table class="log-table" id="logTable">
                    <thead>
                        <tr>
                            <th class="bookmark-column" title="북마크 (더블클릭)">📖</th>
                            <th class="index-column">인덱스</th>
                            <th class="timestamp-column">시간</th>
                            <th class="level-column" style="display: none;">레벨</th>
                            <th class="source-column">출처</th>
                            <th class="tag-column">태그</th>
                            <th class="pid-column">PID</th>
                            <th class="message-column">메시지</th>
                        </tr>
                    </thead>
                    <tbody id="logTableBody">
                        <!-- 로그 행들이 동적으로 추가됩니다 -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- 검색 결과 패널 (하단, 토글 가능) -->
        <div class="log-panel search-results-panel hidden" id="searchResultsPanel">
            <div class="panel-header">
                <span class="panel-title">🔍 검색 결과</span>
                <span class="search-results-info" id="searchResultsInfo">0개 결과</span>
                <div class="panel-controls">
                    <button class="panel-close" id="closeSearchResults" title="검색 결과 패널 닫기">✕</button>
                </div>
            </div>
            <div class="log-table-container">
                <table class="log-table search-results-table">
                    <thead>
                        <tr>
                            <th class="index-column">인덱스</th>
                            <th class="timestamp-column">시간</th>
                            <th class="level-column" style="display: none;">레벨</th>
                            <th class="source-column">출처</th>
                            <th class="tag-column">태그</th>
                            <th class="message-column">메시지</th>
                        </tr>
                    </thead>
                    <tbody id="searchResultsBody">
                        <!-- 검색 결과 로그들이 동적으로 추가됩니다 -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- 북마크 사이드바 (우측, 토글 가능) -->
        <aside class="bookmark-sidebar hidden" id="bookmarkSidebar">
            <div class="sidebar-header">
                <span class="sidebar-title">📖 북마크</span>
                <div class="sidebar-controls">
                    <button class="sidebar-btn" id="exportBookmarks" title="북마크 내보내기">📤</button>
                    <button class="sidebar-btn" id="importBookmarks" title="북마크 가져오기">📥</button>
                    <button class="sidebar-btn" id="clearBookmarks" title="모든 북마크 삭제">🗑️</button>
                    <button class="sidebar-close" id="closeBookmarks" title="사이드바 닫기">✕</button>
                </div>
            </div>
            <div class="bookmark-list" id="bookmarkList">
                <div class="bookmark-empty">
                    북마크된 로그가 없습니다.<br>
                    로그 행을 더블클릭하여 북마크를 추가하세요.
                </div>
            </div>
        </aside>
    </main>

    <!-- 하이라이트 설정 모달 -->
    <div class="modal hidden" id="highlightModal">
        <div class="modal-backdrop"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">🎨 하이라이트 규칙 관리</h3>
                <button class="modal-close" id="closeHighlightModal">✕</button>
            </div>
            <div class="modal-body">
                <div class="modal-description">
                    패턴에 따라 로그 메시지를 색상으로 강조할 수 있습니다. (최대 5개 규칙)
                </div>
                <div class="highlight-rules" id="highlightRules">
                    <!-- 하이라이트 규칙들이 동적으로 추가됩니다 -->
                </div>
                <div class="modal-actions">
                    <button class="btn btn-secondary" id="addHighlightRule">규칙 추가</button>
                    <button class="btn btn-secondary" id="predefinedRules">기본 규칙</button>
                    <span class="rule-count" id="ruleCount">규칙 수: 0/5</span>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" id="saveHighlightRules">적용</button>
                <button class="btn btn-secondary" id="cancelHighlightRules">취소</button>
            </div>
        </div>
    </div>

    <!-- 설정 모달 -->
    <div class="modal hidden" id="settingsModal">
        <div class="modal-backdrop"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">⚙️ 설정</h3>
                <button class="modal-close" id="closeSettingsModal">✕</button>
            </div>
            <div class="modal-body">
                <div class="settings-section">
                    <h4>표시 설정</h4>
                    <div class="setting-item">
                        <label>최대 로그 수:</label>
                        <input type="number" id="maxLogsInput" min="100" max="10000" value="1000">
                    </div>
                    <div class="setting-item">
                        <label>툴팁 표시 지연 (밀리초):</label>
                        <input type="number" id="tooltipDelayInput" min="0" max="5000" value="1000">
                    </div>
                    <div class="setting-item">
                        <label>테마:</label>
                        <select id="themeSelect">
                            <option value="dark">다크</option>
                            <option value="light">라이트</option>
                        </select>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" id="saveSettings">저장</button>
                <button class="btn btn-secondary" id="resetSettings">초기화</button>
                <button class="btn btn-secondary" id="cancelSettings">취소</button>
            </div>
        </div>
    </div>

    <!-- 스크롤 컨트롤 -->
    <div class="scroll-controls">
        <button class="scroll-btn" id="scrollToBottomBtn" title="최신 로그로 이동">
            ⬇ 최신 로그
        </button>
    </div>

    <!-- 숨겨진 파일 입력 (북마크 가져오기용) -->
    <input type="file" id="bookmarkFileInput" accept=".json" style="display: none;">
    <input type="file" id="highlightFileInput" accept=".json" style="display: none;">

    <!-- JavaScript 모듈 로드 -->
    <script type="module" src="/js/app.js"></script>
</body>
</html>
